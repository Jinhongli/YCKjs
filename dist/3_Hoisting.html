<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Scope</title>
    <link rel="stylesheet" href="../style/markdown.css">
    <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/dracula.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
</head>
<body>
    <h1 id="hoisting">Hoisting</h1>
<h2 id="-">先有鸡还是先有蛋</h2>
<p>前面已经讲过了，函数作用域中的变量在函数的任何位置都可以访问到。也就是说鸡（赋值）还没执行，蛋（声明）就可以用了。</p>
<p>举个栗子：</p>
<pre><code class="lang-javascript">foo();

function foo() {
    console.log( a ); // undefined

    var a = 2;
}
</code></pre>
<p><code>a</code>变量的使用在声明之前，但是并不会抛出错误，而是打印<code>undefined</code>。</p>
<p>因为在JS中，函数在执行前会进行预执行（初始化AO、VO），也就是说会对函数作用域下的变量做初始化，将它们统统提升到作用域最顶端。</p>
<p>也就是说，上述代码相当于：</p>
<pre><code class="lang-javascript">// foo 被提前
function foo() {
    // a 被提前
    var a;

    console.log( a ); // undefined

    a = 2;
}

foo();
</code></pre>
<p><strong>注意</strong>：只有函数声明会提升，函数表达式并不会。
<strong>注意</strong>：对于带有函数名的函数表达式，函数名只可以在函数体内部使用，不会暴露在父级作用域下。</p>
<pre><code class="lang-javascript">foo(); // TypeError, 因为 foo=undifined
bar(); // ReferenceError, 因为 bar 不存在

var foo = function bar() {
    // ...
};
</code></pre>
<h2 id="-">函数优先</h2>
<p>如果一个函数声明和一个函数表达式使用的是同一个变量名（WTF？！谁TM会这么写代码😅）</p>
<pre><code class="lang-javascript">foo(); // 1

var foo;

function foo() {
    console.log( 1 );
}

foo = function() {
    console.log( 2 );
};
</code></pre>
<p>JS引擎看到这烂代码之后，一边吐槽一边依然进行变量提升：</p>
<pre><code class="lang-javascript">function foo() {
    console.log( 1 );
}

foo(); // 1

foo = function() {
    console.log( 2 );
};
</code></pre>
<p><code>var foo</code>不见了，因为它与函数声明存在冲突，所以被忽略了（尽管从位置上来说，<code>var foo</code>更靠上）。</p>
<p>那如果这个人又写了烂代码，函数声明重复了呢（无力吐槽🙄）</p>
<pre><code class="lang-javascript">foo(); // 3

function foo() {
    console.log( 1 );
}

var foo = function() {
    console.log( 2 );
};

function foo() {
    console.log( 3 );
}
</code></pre>
<p>这次由于foo都是函数声明，优先级相同，所以依靠先后顺序一决胜负。变量提升之后：</p>
<pre><code class="lang-javascript">function foo() {
    console.log( 3 );
}

foo(); // 3

foo = function() {
    console.log( 2 );
};
</code></pre>
<h2 id="-">总结</h2>
<p>JS函数在执行前，会进行预执行，对作用域内的变量提升至最顶端，并进行初始化。但是变量的赋值依然在原来的位置。</p>
<p>如果变量定义存在冲突，注意它们的优先级。</p>

    <script >hljs.initHighlightingOnLoad();</script>
</body>
</html>
